# Что такое авторизация?
Авторизация — это процесс проверки прав доступа пользователя к ресурсам и функциям системы на основе его роли или полномочий.

![auth](https://production-it-incubator.s3.eu-central-1.amazonaws.com/file-manager/Image/834e4e39-b134-4c8b-8a9f-a01c73be8f71_use-jwt.png)

## 1. Авторизация с использованием JWT
JWT (JSON Web Token) — это популярный метод авторизации, 
который используется для создания безопасных токенов, передающихся между клиентом и сервером.
Эти токены содержат информацию о пользователе и его правах доступа, 
которая может быть проверена сервером.

Основные особенности JWT:
 - **Токен формируется сервером** и содержит полезную нагрузку (payload), которая может включать информацию о пользователе (например его ID).
 - **Токен подписывается** секретным ключом, что позволяет проверить его подлинность.
 - **Клиент** (например, браузер или мобильное приложение) хранит токен и отправляет его с каждым запросом к серверу в заголовке `Authorization`.

<img src="https://production-it-incubator.s3.eu-central-1.amazonaws.com/file-manager/Image/62cc7947-18f1-4940-ab8f-ab86fcce05c7_jwt.png" alt="jwt" width="900" height="100">

### 1.1 Как JWT работает в NestJS
В NestJS JWT реализуется с использованием библиотеки `@nestjs/jwt` и `@nestjs/passport`. 
Взаимодействие между клиентом и сервером выглядит следующим образом:

- **Аутентификация (login) пользователя**: Пользователь отправляет свои учетные данные (например, email и пароль) на сервер. 
Если данные верны, сервер генерирует JWT и возвращает его пользователю.

- **Хранение токена на клиенте**: JWT сохраняется на стороне клиента (например, в localStorage или cookies).

- **Отправка токена при запросах**: При каждом последующем запросе на защищенные ресурсы (эндпоинты) клиент добавляет JWT
в заголовок `Authorization`.

- **Валидация токена на сервере**: Сервер проверяет подлинность токена, декодирует его и определяет, имеет ли пользователь право на выполнение запрашиваемой операции.

- **Авторизация доступа**: Если токен валиден, запрос обрабатывается и возвращается ответ. 
Если токен не валиден, сервер возвращает ошибку (**401 Unauthorized**).

## 2. Использование [Passport.js в NestJS](https://docs.nestjs.com/recipes/passport) для аутентификации и авторизации
`Passport.js` — это гибкий и модульный middleware для Node.js, 
который предоставляет различные стратегии аутентификации, 
включая локальную стратегию (с использованием логина и пароля) и 
JWT (JSON Web Token) стратегию. В NestJS `Passport.js` тесно интегрируется
с приложением через модули `@nestjs/passport` и `@nestjs/jwt`, что упрощает 
реализацию аутентификации и авторизации.

##### Основные моменты использования Passport.js в NestJS:
 - **Стратегии аутентификации**: `Passport.js` поддерживает множество стратегий аутентификации. 
В нашем случае мы будем использовать **локальную стратегию** для логина и **JWT стратегию** для защиты маршрутов.

 - **Гибкость и расширяемость**: `Passport.js` легко настраивается и расширяется, что позволяет добавлять новые стратегии или модифицировать существующие под нужды вашего приложения.

 - **Гарды (Guards)**: В NestJS Guard (например, `AuthGuard`) используется для связывания стратегии `Passport.js` с маршрутами.
Guard перехватывает запросы и передает их через стратегию, чтобы проверить аутентификацию пользователя.

 - **Поддержка JWT**: С `Passport.js` и `@nestjs/jwt` легко интегрировать JWT стратегию, которая используется для создания и проверки токенов, 
обеспечивая безопасность доступа к защищенным маршрутам.
